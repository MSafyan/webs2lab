<!-- FA18-BSEE-099 LABWA ALI
FA18-BSE-080 M SAFYAN 
SP18-BSE-143 MUZAMIL RAFIQ 
https://github.com/MSafyan/A2Web
https://a2webs.herokuapp.com/
-->

<!DOCTYPE html>
<html>
<head>
  <title>JQuery Exercise</title>
      <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
  

</head >
<body>
<div class="container" style="margin-top: 10rem;">
  <div class="row">
    <div class="col-4 cform">
        <label>Add/Drop persons</label>
        <form class="m-3 form" id="form" onsubmit="event.preventDefault(); formClear();">
          <div class="form-group">
            <label>Name:</label>
            <input  onkeydown="return alphaOnly(event);"  type="text" name="Name" required id="name" class="form-control" pattern="[A-Za-z]{1,10}" maxlength="10" placeholder="enter your name">
          </div>
          <div class="form-group">
            <label>Gender:</label>
            <input type="radio" id="contactChoice2" name="gender" value="female">
            <label for="contactChoice1">Female</label>
            <input type="radio" id="contactChoice1" name="gender"  value="male">
            <label for="contactChoice1">Male</label>
          </div>
          <div class="form-group">
            <label>Age:</label>
            <input type="number" id="age" name="age" class="form-control" required="" min="10" max="50" placeholder="enter your age">
          </div>
          <div class="form-group">
            <label>City:</label>
            <select id="city" name="city">
              <option value="lahore">Lahore</option>
              <option value="gujrat">Gujrat</option>
              <option value="gujranwala">gujranwala</option>
              <option value="Sahiwal">Sahiwal</option>
            </select>
          </div>
          <button name="add" id="add" class="add buttons btn-primary"> Save </button>
          <button  type="reset" name="reset" id="reset" class="btn btn-danger btn-clear">Clear</button>
          <button name="update" type="submit" id="update" disabled class="update buttons">update</button>
          </div>
        </form><br>
      
    <div class="col-2"></div>
    <div class="col-6 ctable">
      <label>List of persons</label>

      <table id='table' class="table table-bordered data-table">
        <thead>
          <th>Name</th>
          <th>Gender</th>
          <th>Age</th>
          <th>City</th>
          <th>Action</th>
        </thead>
        <tbody id="tbody" class="tbody">
          
        </tbody>
      </table>
    </div>
  </div>
    


</div>
    </div>

   <script type="text/javascript">
   function alphaOnly(event) {
      var key = event.keyCode;
      return ((key >= 65 && key <= 90) || key == 8);
    };
    // $("form").submit(function(e) {
    //   e.preventDefault();
    //   var name=$("input[name='name']").val();
    //   var gender=$("input[name='gender']").val();
    //   var age=$("input[name='age']").val();
    //   var city=$("select[name='city']").val();

    //    $(".data-table tbody").append("<tr data-name='"+name+"' data-gender='"+gender+"' data-age='"+age+"' data-city='"+city+"'><td>"+name+"</td><td>"+gender+"</td><td>"+age+"</td><td>"+city+"</td><td><button class='btn btn-secondary btn-lg btn-delete mr-3' type='button'>Delete</button><button class='btn btn-info btn-lg btn-edit' type='button'>Edit</button></td></tr>");

    //    $("input[name='']").val("");
    // });

    // $('body').on('click','.btn-delete',function() {
    //   $(this).parents('tr').remove();
    // });

    // $('body').on('click','.btn-edit',function() {
    //   var name=$(this).parents('tr').attr('data-name');
    //   var gender=$(this).parents('tr').attr('data-gender');
    //   var age=$(this).parents('tr').attr('data-age');
    //   var city=$(this).parents('tr').attr('data-city');

    //   // console.log(city)

    //   $(this).parents('tr').find('td:eq(0)').html("<input name='edit_text' value='"+name+"'>");
    //   $(this).parents('tr').find('td:eq(1)').html("<input name='edit_gender' value='"+gender+"'>");
    //   $(this).parents('tr').find('td:eq(2)').html("<input name='edit_age' value='"+age+"'>");
    //   $(this).parents('tr').find('td:eq(3)').html("<select name='edit_city' value='"+city+"'>");

    //   $(this).parents('tr').find('td:eq(4)').prepend("<button type='button' class='btn btn-info btn-lg btn-update mr-3'>Update</button>");
    //   $(this).hide()
    // });

    // $('body').on('click','.btn-update',function() {
    //   var name=$(this).parents('tr').find("input[name='edit_text']").val();
    //   var gender=$(this).parents('tr').find("input[name='edit_gender']").val();
    //   var age=$(this).parents('tr').find("input[name='edit_age']").val();
    //   var city=$(this).parents('tr').find("select[name='edit_city']").val();

    //   console.log(city)

    //   $(this).parents('tr').find('td:eq(0)').text(name);
    //   $(this).parents('tr').find('td:eq(1)').text(gender);
    //   $(this).parents('tr').find('td:eq(2)').text(age);
    //   $(this).parents('tr').find('td:eq(3)').text(city);

    //   $(this).parents('tr').attr('data-name',name);
    //   $(this).parents('tr').attr('data-gender',gender);
    //   $(this).parents('tr').attr('data-age',age);
    //   $(this).parents('tr').attr('data-city',city);

    //   $(this).parents('tr').find('.btn-edit').show();
    //   $(this).parents('tr').find('.btn-update').remove();

    // })
    // $('body').on('click','.btn-clear',function(){
    //   console.log('heelo');
    //   $("input[name='name']").val('');
    //   $("input[name='age']").val('');
    //   $("input[name='gender']").val('');

    // })

    var updateObject;
    const UserObject = [
        
      ];
      $(function () {

        $("#add").click(addRow);
        $("#update").click(updateRow);
        $("#reset").click(resetRow);
      });




      function addRow() {
// console.log('hello')
        if (checkValidity()) {
          const name = $("#name").val();
          const gender = $("#form")[0].gender.value;
          console.log(gender)
          const age = $("#age").val();
          const city = $("#city").val();
          // if(UserObject.some(e => e.name === name))
          let obj = {
            id: UserObject[UserObject.length - 1] + 1,
            name, gender, age, city
          }
          UserObject.push(obj);

          // const { name,gender,age,city } = Obj;
          $("#tbody").append(`<tr>
        <td>${name}</td>
        <td>${gender}</td>
        <td>${age}</td>
        <td>${city}</td>
        <td>
            <button class="edit" id="${obj.id}"  onclick="editRow(this)">Edit</button>
            <button class="Remove" id="${obj.id}" onclick="removeRow(this)">Remove</button>
        </td>
    </tr>`)

        }
        // myFunction();



      }
      // 
      function removeRow(oButton) {
        // setIndex();
        console.log(oButton.parentNode.parentNode.rowIndex)
        UserObject.filter(e => e.id === oButton.id);
        document.getElementById("table").deleteRow(oButton.parentNode.parentNode.rowIndex);


        console.log(oButton.parentNode.parentNode.rowIndex);

      }

      function editRow(oButton) {
        // setIndex();
        const name = $("#name");
        const gender = $("#form").gender;
        const age = $("#age");
        const city = $("#city");
        let row = $(oButton).parents("tr")
        var cols = row.children("td");
        $("#name").val($(cols[0]).text());
        $("#form")[0].gender.value = $(cols[1]).text();
        $("#age").val($(cols[2]).text());
        $("#city").val($(cols[3]).text());
        $("#update").attr("disabled", false);
        $("#add").attr("disabled", true);
        updateObject = oButton;

      }
      function updateRow() {
        if (updateObject && checkValidity()) {
          const name = $("#name");
          const gender = $("#form")[0].gender;
          const age = $("#age");
          const city = $("#city");
          let row = $(updateObject).parents("tr")
          var cols = row.children("td");
          cols[0].innerText = name.val();
          cols[1].innerText = gender.value;
          cols[2].innerText = age.val();
          cols[3].innerText = city.val();

          $("#update").attr("disabled", true);
          $("#add").attr("disabled", false);
          UserObject.forEach(data => {
            if (data.id === updateObject.id) {
              data.name = name.val();
              data.gender = gender.value;
              data.age = age.val();
              data.city = city.val();
            }
          })
          updateObject = '';
          formClear();

        }
        else alert("Can't find the row to update")
      }


      function resetRow() {

        formClear();
        $("#update").attr("disabled", true);
        $("#add").attr("disabled", false);
        updateObject = '';

      }
      function checkValidity() {
        let name = $("#name").val();
        let age = $("#age").val();
        if(!$("#form")[0].gender.value && $("#age").val()){
          alert('please fill gender')
        }
        if ($("#name").val() && $("#form")[0].gender.value && $("#age").val() && $("#city").val())
          if (name === name.toUpperCase() || name === name.toLowerCase()) {
            if (age >= 10 && age <= 50) {
              return true;
            } else {
              alert("Age should be between 10 to 50")
              return false
            }

          } else {
            alert("name should be upper or lower case only")
            return false;
          }
        else false
      }

  function myFunction() {
    document.getElementById("myform").reset();
  }
  function formClear() {
    $("#name").val("");
    $("#form")[0].gender.value = null
    $("#age").val("");
    $("#city").val("");
  }
 
   </script>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
     <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>


